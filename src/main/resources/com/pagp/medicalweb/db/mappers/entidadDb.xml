<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pagp.medicalweb.db.mappers.EntidadDb">


	<select id="obtenerEntidades" resultType="EntidadEntity"  >
		SELECT * FROM entidades 
	</select>

	<select id="obtenerEntidadesAll" resultType="EntidadEntity" parameterType="int" >
		SELECT * FROM entidades WHERE idAdministrador = #{value}
	</select>
	
	<select id="obtenerModulosEntidadActuales" resultType="ModuloContratadoEntity" parameterType="int" >
		SELECT * FROM moduloContratado
		WHERE activo = #{value} 
		and estatus = 1
	</select>
	
	 <insert id='crearSolicitud' parameterType='SolicitudEntity' useGeneratedKeys='true' keyProperty='idSolicitud'>
	   INSERT INTO solicitudes
	   	( tipo_solicitud, descripcion, impresion, idPaciente )
	    VALUES( #{tipo_solicitud}, #{descripcion}, #{impresion}, #{idPaciente}) 
 	 </insert>
 	 
 	  <insert id='crearReceta' parameterType='RecetaEntity' keyProperty='idReceta'>
	   INSERT INTO recetas
	   	( idReceta, comentarios )  VALUES( #{idReceta}, #{comentarios}) 
 	 </insert>
 	 
 	   <insert id='crearMedicamentoReceta' parameterType='MedicamentoRecetaEntity'>
		 	INSERT INTO "dbo"."receta_medicamento" 
		 		(idReceta,idMedicamento,dosis,toma,tipo_administracion,desde,hasta)
		 	 VALUES (#{idReceta},#{idMedicamento},#{dosis}
		 	 ,#{toma},#{tipo_administracion},#{desde},#{hasta})
	 	</insert>
	 	
 	   <insert id='crearDiagnostico' parameterType='DiagnosticoEntity'>
		 	INSERT INTO diagnostico
		 		(idDiagnostico,idDoctor,diagnostico,tratamiento)
		 	 VALUES (#{idDiagnostico},#{idDoctor},#{diagnostico} ,#{tratamiento})
	 	</insert>
	 	 
	 	 
	 	   <update id='actualizarReceta'  parameterType='RecetaEntity'  >
			   UPDATE  recetas  SET   estatus = #{estatus } WHERE  idReceta = #{idReceta} 
	 	 </update>
 	 
 	   <update id='actualizarSolicitud'  parameterType='SolicitudEntity'>
				UPDATE  solicitudes  SET   estatus = #{estatus } WHERE  idSolicitud = #{idSolicitud} 
	 	</update>
	 	
 	   <update id='actualizarDiagnostico'  parameterType='DiagnosticoEntity'>
				UPDATE  diagnostico  SET   estatus = #{estatus } WHERE  idDiagnostico = #{idDiagnostico} 
	 	</update>
	 	 
	 	 
		<select id="getEnfermero" resultType="EnfermeroEntity" parameterType="int" >
				SELECT * FROM enfermeros WHERE idEnfermero = #{value}
		</select>
			
		<select id="getFarmacologo" resultType="FarmacologoEntity" parameterType="int" >
				SELECT * FROM farmacologos WHERE idFarmacologo = #{value}
		</select>
			
			
		<select id="getAdministradorCE" resultType="AdministradorCEEntity" parameterType="int" >
				SELECT * FROM administradores_ce WHERE idAdministrador = #{value}
		</select>
	 	 
	 	 <select id="getRecetas" resultType="RecetaEntity" parameterType="int" >
				SELECT * FROM recetas r
				left join  diagnostico  d on r.idReceta = d.idDiagnostico
				left join solicitudes s on s.idSolicitud = d.idDiagnostico
				left join pacientes  p on p.idPaciente = s.idPaciente
				 WHERE p.idEntidad = #{value} 	and r.estatus = 'ABIERTA'
		</select>
	 	 
	 	  <select id="getReceta" resultType="RecetaEntity" parameterType="int" >
				SELECT * FROM recetas r
				left join  diagnostico  d on r.idReceta = d.idDiagnostico
				left join solicitudes s on s.idSolicitud = d.idDiagnostico
				left join pacientes  p on p.idPaciente = s.idPaciente
				 WHERE r.idReceta = #{value}
		</select>
	 	 
	 	 <resultMap id="recetaResult" type="RecetaEntity">
				<result column="paciente_nombre" property="nombre"/>
		</resultMap>
	 	 
	 	 
	 	 
</mapper>